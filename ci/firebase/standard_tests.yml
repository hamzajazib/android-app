.project-vars: &project-vars
  vault-path-service-account: "vpn_team/gitlab-projects/variables/509/firebase_service_account@kv-team"
  cloud-project-id: $CLOUD_PROJECT_ID

.black-apk-paths: &black-apk-paths
  app-apk-path: "app/build/outputs/apk/blackGooglePlayStore/debug"
  test-apk-path: "app/build/outputs/apk/androidTest/blackGooglePlayStore/debug"

.production-apk-paths: &production-apk-paths
  app-apk-path: "app/build/outputs/apk/productionGooglePlayStore/debug"
  test-apk-path: "app/build/outputs/apk/androidTest/productionGooglePlayStore/debug"

include:
  - component: gitlab.protontech.ch/devex/android-firebase-testing/firebase-test@0.0.3
    inputs:
      <<: *project-vars
      <<: *black-apk-paths
      job-name: mobile tests mocked api
      device-config: "mobileTest"
      num-shards: "2"
      test-targets: "class com.protonvpn.testSuites.MobileMockApiSuite"
      timeout: $TIMEOUT_MOCKED_TESTS

  - component: gitlab.protontech.ch/devex/android-firebase-testing/firebase-test@0.0.3
    inputs:
      <<: *project-vars
      <<: *production-apk-paths
      job-name: mobile tests real connection
      device-config: "smokeTest"
      test-targets: "class com.protonvpn.testSuites.RealConnectionTestSuite"
      timeout: $TIMEOUT_GENERAL_TESTS
      allowed-to-fail: true

  - component: gitlab.protontech.ch/devex/android-firebase-testing/firebase-test@0.0.3
    inputs:
      <<: *project-vars
      <<: *production-apk-paths
      job-name: mobile tests test-env
      device-config: "mobileTest"
      test-targets: "class com.protonvpn.testSuites.MobileBlackSuite"
      timeout: $TIMEOUT_GENERAL_TESTS
      environment-variables: "clearPackageData=true,useTestStorageService=true,host=$DYNAMIC_DOMAIN,proxyToken=$BLACK_TOKEN"

  - component: gitlab.protontech.ch/devex/android-firebase-testing/firebase-test@0.0.3
    inputs:
      <<: *project-vars
      <<: *black-apk-paths
      job-name: tv tests
      device-config: "tvTest"
      test-targets: "class com.protonvpn.testSuites.TvSuite"
      timeout: $TIMEOUT_GENERAL_TESTS

  - component: gitlab.protontech.ch/devex/android-firebase-testing/firebase-test@0.0.3
    inputs:
      <<: *project-vars
      job-name: release tests
      app-apk-path: "app/build/outputs/apk/productionGoogleDev/release"
      test-apk-path: "release_tests/build/outputs/apk/release"
      device-config: "smokeTest"
      test-targets: "class com.protonvpn.android.release_tests.suites.AllTests"
      timeout: $TIMEOUT_GENERAL_TESTS